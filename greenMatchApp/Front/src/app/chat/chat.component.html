<app-barra-superior (toggleSideBar)="toggleSidebar()"></app-barra-superior>

<!-- Overlay para mobile cuando el sidebar está abierto -->
<div class="sidebar-backdrop" *ngIf="showSidebar" (click)="toggleSidebar()"></div>

<!-- Sidebar -->
<aside class="sidebar" [class.sidebar--open]="showSidebar">
  <header class="sidebar__header">
    <h3>Conversaciones</h3>
    <button type="button" class="sidebar__new" (click)="newConversation()">
      + Nueva conversación
    </button>
  </header>

  <section class="sidebar__body">
    <ng-container *ngIf="pastConversations?.length; else noConversations">
      <ul class="sidebar__list">
        <li
          *ngFor="let conv of pastConversations"
          class="sidebar__item"
          [class.sidebar__item--active]="conv.id === sessionId"
          (click)="selectConversation(conv)">
          <div class="sidebar__item-title">
            {{ conv.title || ('Chat #' + conv.id) }}
          </div>
          <div class="sidebar__item-meta">
            Última actividad:
            {{ conv.last_activity_at | date: 'short' }}
          </div>
        </li>
      </ul>
    </ng-container>

    <ng-template #noConversations>
      <div class="sidebar__empty">
        <p>No tienes conversaciones previas.</p>
        <p>Empieza una nueva para verlas aquí.</p>
      </div>
    </ng-template>
  </section>
</aside>

<main class="chat-page">
  <section class="chat-card" aria-label="Conversación">
    <div class="chat-card__messages" role="log" aria-live="polite">
      <ng-container *ngIf="messages.length > 0; else emptyState">
        <div
          *ngFor="let msg of messages"
          class="chat-card__message"
          [class.chat-card__message--self]="msg.sender === 'user'"
          role="listitem">
          <span>{{ msg.content }}</span>
        </div>
      </ng-container>
    </div>

    <ng-template #emptyState>
      <div class="chat-card__empty" role="presentation">
        <img src="assets/chat-verde.png" alt="Ilustración de chat" loading="lazy" />
        <h2>Bienvenido al chat</h2>
        <p>Envía tu primer mensaje para iniciar la conversación.</p>
      </div>
    </ng-template>

    <form class="chat-card__composer" (ngSubmit)="handleSubmit()" novalidate>
      <label class="visually-hidden" for="chat-message">Escribe tu mensaje</label>
      <div class="chat-card__input">
        <input
          id="chat-message"
          name="message"
          type="text"
          [(ngModel)]="newMessage"
          placeholder="Escribe un mensaje..."
          autocomplete="off"
          aria-label="Mensaje a enviar" />
      </div>
      <button
        class="chat-card__send"
        type="submit"
        [disabled]="!newMessage.trim()">
        Enviar
      </button>
    </form>
  </section>
</main>

<app-barra-inferior></app-barra-inferior>
